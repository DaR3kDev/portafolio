---
import { Sun, Moon } from '@lucide/astro'
---

<button
  id="theme-toggle"
  type="button"
  aria-label="Cambiar tema"
  class="relative flex items-center justify-center
         w-9 h-9 sm:w-10 sm:h-10
         rounded-lg
         bg-white dark:bg-neutral-950
         border border-black/10 dark:border-white/10
         hover:bg-black/5 dark:hover:bg-white/10
         transition
         focus:outline-none"
>
  <!-- Icono Sol -->
  <Sun class="absolute w-4 h-4 sm:w-5 sm:h-5 hidden dark:block text-gray-800 dark:text-gray-200" />

  <!-- Icono Luna -->
  <Moon class="absolute w-4 h-4 sm:w-5 sm:h-5 block dark:hidden text-gray-800 dark:text-gray-200" />
</button>

<script>
  const toggle = document.querySelector('#theme-toggle')
  const root = document.documentElement

  const savedTheme = localStorage.theme
  const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches

  const setTheme = (theme: string) => {
    root.setAttribute('data-theme', theme)
    localStorage.theme = theme
  }

  setTheme(savedTheme || (systemDark ? 'dark' : 'light'))

  const switchTheme = () => {
    const current = root.getAttribute('data-theme')
    setTheme(current === 'dark' ? 'light' : 'dark')
  }

  toggle?.addEventListener('click', () => {
    if ('startViewTransition' in document) {
      document.startViewTransition(switchTheme)
    } else {
      switchTheme()
    }
  })
</script>
