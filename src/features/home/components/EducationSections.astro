---
import Pagination from '~/components/pagination/Pagination'
import { currentPage, projectsPerPage } from '~/stores/projectStore'

const $currentPage = currentPage.get()
const $itemsPerPage = projectsPerPage.get()

export const diplomas = [
  {
    title: 'Backend con Node.js',
    institution: 'Platzi',
    date: '2024',
    image: '/diplomas/node.png',
    file: '/diplomas/node.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
  {
    title: 'React Profesional',
    institution: 'Udemy',
    date: '2023',
    image: '/diplomas/react.png',
    file: '/diplomas/react.pdf',
  },
]

const paginatedDiplomas = diplomas.slice(
  ($currentPage - 1) * $itemsPerPage,
  $currentPage * $itemsPerPage,
)
---

<section id="education" class="py-24 px-6 max-w-6xl mx-auto">
  <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Diplomas y Certificaciones</h2>

  <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
    {
      paginatedDiplomas.map(d => (
        <article class="bg-white dark:bg-zinc-900 rounded-2xl shadow hover:shadow-xl transition overflow-hidden">
          <button
            class="w-full open-modal"
            data-src={d.image}
            aria-label={`Ver ${d.title} en grande`}
          >
            <img src={d.image} alt={d.title} class="w-full h-48 object-cover" loading="lazy" />
          </button>

          <div class="p-5 space-y-2">
            <h3 class="font-semibold text-lg">{d.title}</h3>
            <p class="text-sm opacity-70">{d.institution}</p>
            <p class="text-xs opacity-50">{d.date}</p>

            <div class="flex gap-4 pt-2">
              <a
                href={d.file}
                download
                target="_blank"
                class="text-sm font-medium text-blue-500 hover:underline"
              >
                Ver PDF
              </a>

              <button
                class="text-sm font-medium text-zinc-500 hover:underline open-modal"
                data-src={d.image}
              >
                Ver en grande
              </button>
            </div>
          </div>
        </article>
      ))
    }
  </div>

  <Pagination totalItems={diplomas.length} client:load />

  <!-- MODAL -->
  <div
    id="modal"
    class="fixed inset-0 hidden bg-black/70 backdrop-blur-sm items-center justify-center z-50"
  >
    <img
      id="modalImg"
      class="max-h-[90vh] max-w-[90vw] rounded-xl shadow-2xl"
      alt="Vista previa del diploma"
    />
  </div>
</section>

<script is:inline lang="ts">
  const modal = document.querySelector('#modal')
  const modalImg = document.querySelector('#modalImg')

  document.addEventListener('click', e => {
    const button = e.target.closest('.open-modal')

    if (!button) return

    const src = button.dataset.src

    if (!src) return

    modalImg.src = src
    modal.classList.remove('hidden')
    modal.classList.add('flex')
  })

  modal.addEventListener('click', () => {
    modal.classList.add('hidden')
    modal.classList.remove('flex')
    modalImg.src = ''
  })
</script>
